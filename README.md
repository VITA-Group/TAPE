<h1 align="center">Rethinking Addressing in Language Models via Contextualized Equivariant Positional Encoding (TAPE)</h1>
<p align="center">
    <a href="https://arxiv.org/abs/2501.00712"><img src="https://img.shields.io/badge/arXiv-2501.00712-B31B1B?labelColor=white&logo=data:image/vnd.microsoft.icon;base64,AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAClrLMApayzAKWsswClrLMGpayzgqWss/alrLOLpayzAqWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJSCzACUgswAlILMAJSCzACUgswAlILMAJSCzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApayzAKWsswClrLMApayzB6Wss3ylrLP1payz/6Wss66lrLMGpayzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlILMAJSCzACUgsw0lILMqJSCzCiUgswAlILMAJSCzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKWsswClrLMApayzAKWsswqlrLOGpayz+aWss/+lrLPgpayzPKWsswClrLMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACUgswAlILMHJSCzlSUgs+slILOZJSCzEyUgswAlILMAJSCzAAAAAAAAAAAAAAAAAAAAAAClrLMApayzAKWsswClrLMNpayzj6Wss/ulrLP/payz76Wss1elrLMApayzAKWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJSCzACUgsxIlILPQJSCz/yUgs/8lILOoJSCzGSUgswAlILMAJSCzAAAAAAAAAAAApayzAKWsswClrLMApayzEKWss5elrLP9payz/6Wss/qlrLN2payzAaWsswClrLMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlILMAJSCzACUgs3MlILP7JSCz/yUgs/8lILOzJSCzICUgswAlILMAJSCzAKWsswClrLMApayzAKWssxSlrLOfpayz/qWss/+lrLP/payzlaWsswilrLMApayzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACUgswAlILMAJSCzCiUgs5olILP/JSCz/yUgs/8lILO+JSCzKCUgswAkH7MAnaSzAKWs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s5enrrMKpq2zAKWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACUgswAlILMAJSCzDiUgs6UlILP/JSCz/yUgs/8kH7P/Pzyz/4yQs/+nrrP/payz+6Wss32lrLMDpayzAKWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlILMAJSCzACUgswQlILOFJSCz/SUgs/8lILP/JSCz/yQfs8V9gLORp66z9KWss/+lrLP/payz86Wss2GlrLMApayzAKWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJSCzACUgswAlILMAJSCzZSUgs/UlILP/JSCz/yUgs/8lILPBIx6zKP//swKlrLNspayz76Wss/+lrLP/payz56Wss0elrLMApayzAKWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACUgswAlILMAJSCzACUgs0clILPnJSCz/yUgs/8lILP/JSCzuyUgsyQkH7MApq2zAKWsswGlrLNbpayz56Wss/+lrLP/payz1qWsszClrLMApayzAKWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlILMAJSCzACUgswAlILMtJSCz1CUgs/8lILP/JSCz/yUgs7UlILMfJSCzACUgswCgprMApayzAKWsswClrLNMpayz3aWss/+lrLP/payzwaWssx6lrLMApayzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACUgswAlILMAJSCzGSUgs7olILP/JSCz/yUgs/8lILOuJSCzGyUgswAlILMAJSCzAAAAAAClrLMApayzAKWsswClrLM9payz0qWss/+lrLP/payzpaWssw2lrLMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlILMAJSCzACUgswslILOcJSCz/yUgs/8lILP/JSCzpyUgsxglILMAJSCzACUgswAAAAAAAAAAAAAAAAClrLMApayzAKWsswClrLMwpayzxaWss/+lrLPupayzMaWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJSCzACUgswAlILMDJSCzfCUgs/slILP/JSCz/iUgs6AlILMUJSCzACUgswAlILMAAAAAAAAAAAAAAAAAAAAAAAAAAAClrLMApayzAKWsswClrLMkpayzlqWss3WlrLMKpayzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlILMAJSCzACUgs1YlILPyJSCz/yUgs/0lILOZJSCzESUgswAlILMAJSCzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAClrLMApayzAKWsswClrLMBpayzAKWsswClrLMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACUgswAlILMHJSCztiUgs/8lILP6JSCzkSUgsw4lILMAJSCzACUgswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAClrLMApayzAKWsswClrLMApayzAKWsswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJSCzACUgswElILOAJSCz9yUgs5klILMNJSCzACUgswAlILMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA///4A/gP8AP4B+AD+APAA/gBgAf4AAAP+AAAD/wAAB/8AAA//gAAf/8AAP//gAH//4AB//8AAP//AAD//wAA//8AAP//AAD//4AA//+AAf//AAH//wAA//4AAH/8AAA/+AAAH/AAAB/wAIAf4AHAH8AD4B/AB/AfwA/4H8Af//8=" alt="Paper"></a>
    <!-- <a href=""><img src="https://img.shields.io/badge/-Github-grey?logo=github" alt="Github"></a> -->
    <a href="https://openreview.net/forum?id=Us1RXG1Ji2&noteId=Us1RXG1Ji2"> <img alt="License" src="https://img.shields.io/badge/ICLR%2725-OpenReview-blue?logoSize=auto&labelColor=white&logo=data:image/vnd.microsoft.icon;base64,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"> </a>
    <a href="https://github.com/VITA-Group/TAPE"><img src="https://img.shields.io/github/stars/VITA-Group/TAPE"></a>
</p>


This repository contains the official implementation of TAPE as described in the paper: [Rethinking Addressing in Language Models via Contextualized Equivariant Positional Encoding]() by Jiajun Zhu, Peihao Wang, Ruisi Cai, Jason D. Lee, Pan Li, Zhangyang Wang.


## Getting Started
```shell
conda create -n adape python=3.10
conda activate adape
pip install -r requirements.txt
pip install flash-attn --no-build-isolation
```

## Arithmetic Learning
It is implemented independently under the directory `arithmetic/`, another github repo linked as submodule. It should has independent environment as well. Please refer to its [README](https://github.com/zhuconv/arithmetic/blob/main/README.md) for detailed instructions about training and evaluation.

## Training From Scratch
### Pretraining
The scripts under script/ covers the commands for training. For example, you can start training TAPE (`adape` in code) model with the following command:

```shell
export TYPE=adape
bash script/train.sh
```
You can change CONFIG_NAME to choose different positional encoding variants. (`choose from those under config/`)

### Finetuning on SCROLLS and Evaluation
There are three steps to get evaluation results:
1. finetune pre-trained models on SCROLLS
2. generate answers in validation set
3. evaluate the answers with corresponding metric

```shell
export TYPE=adape DATASET_NAME=quality
export METRIC_DIR=scrolls/metrics
export SAVE_DIR=scrolls/quality
bash script/ft_scrolls.sh # assume the pretrained checkpoint is under output/${TYPE}_c4, if not, need to set 'output_name=<your_output_name>'
bash script/gen_scrolls.sh
python eval_scrolls.py --split validation --dataset_name $DATASET_NAME --predictions ${SAVE_DIR}/${TYPE}.json  --metrics_output_dir $METRIC_DIR
```

You can change DATASET_NAME to choose different dataset. (`choose from ['narrative_qa', 'quality', "qasper", 'contract_nli']`)

## PEFT Llama2-7B
### Finetuning
Similiar to training from scratch, you can use the following command ans select different methods: 
```shell
export TYPE=adape
bash script/train_llama.sh
```

### Evaluation
For finetuning perplexity evaluation, you need to manually download data hosted by [LongLoRA](https://github.com/dvlab-research/LongLoRA/tree/main)

| Dataset    | Split      | Link                                                                                                         |
|:-----------|------------|--------------------------------------------------------------------------------------------------------------|
| PG19       | test       | [pg19/test.bin](https://drive.google.com/file/d/1QANDMdctpacPAYgS04adDXqByGEq-Ret/view?usp=share_link)       |
| Proof-pile | test       | [proof-pile/test_sampled_data.bin](https://drive.google.com/file/d/1bUI5lPDvrqzY_XXJJ2sSuvZx0Y9AZClE/view?usp=share_link)         |
 
 Then you can use the following command:
```shell
data=proof_pile
model_path=output/llama_adape
bash script/eval_llama.sh
```

We also have `eval_retrieval.py` for evaluation on passkey retrieval task.
```shell
python3 eval_retrieval.py --context_size 8192 --base_model output/llama_adape --max_tokens 8192 --interval 1000
```


## Credits
The codebase are inherited from [BiPE](https://github.com/zhenyuhe00/BiPE) and [LongLoRA](https://github.com/dvlab-research/LongLoRA/tree/main). Thanks to their excellent work!
